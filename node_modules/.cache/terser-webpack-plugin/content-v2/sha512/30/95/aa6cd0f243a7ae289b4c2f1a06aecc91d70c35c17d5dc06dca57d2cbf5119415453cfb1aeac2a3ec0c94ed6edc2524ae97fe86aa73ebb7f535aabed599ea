{"code":"!function(t,e){if(\"object\"==typeof exports&&\"object\"==typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{var i=e();for(var o in i)(\"object\"==typeof exports?exports:t)[o]=i[o]}}(this,function(){return function(t){var e={};function i(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)i.d(o,r,function(e){return t[e]}.bind(null,r));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"\",i(i.s=0)}([function(t,e,i){const o=i(1),r=i(2);var n=i(!function(){var t=new Error(\"Cannot find module 'request'\");throw t.code=\"MODULE_NOT_FOUND\",t}()),c=i(!function(){var t=new Error(\"Cannot find module 'async'\");throw t.code=\"MODULE_NOT_FOUND\",t}());t.exports=class{constructor(t={}){o.checkDataAction(\"Object\",t,\"option必须为对象\")&&(this.imgList=[],this.option=Object.assign({replace_image_url:\"http://ww1.sinaimg.cn/large/\",new_image_url:\"https://xxx.com/目录地址/\",add_end:\"\",read_markdown_src:\"./source\",down_img_src:\"./markdown_img_src\",copy_item_data:\"copy_item_obkoro\",var_number:0,is_link:!0,test:!0,write_file_time:3e3,downFileNameCallBack:null,filter_item:[\".git\"]},t),this.option.copy_item_data&&(this.copyNow=!0,this.copyDir(this.option.read_markdown_src,this.option.copy_item_data,t=>{console.log(\"复制文件夹报错：\",t)})))}checkDownImg(){this.readFile(this.option.read_markdown_src),console.log(`图片提取完成共：${this.imgList.length}张`,this.imgList),this.downImg()}replaceMarkdown(){let t=0;this.copyNow&&(t=this.option.write_file_time,this.copyNow=!1),setTimeout(()=>{this.readFile(this.option.read_markdown_src,!0),console.log(\"修改图片地址成功\")},t)}reg(t){let e=t=>t=(t=t.replace(/\\//g,\"\\\\/\")).replace(/\\./g,\"\\\\.\"),i=this.option.replace_image_url,o=\"!\";return this.option.is_link&&(o=\"\"),{sectionUrl:new RegExp(`(${e(i)}${(t=>{let e=\"\";return t>0?(e+=\".*\\\\/\".repeat(t),e+=\")\"):e=\")\",e})(this.option.var_number)}`,\"g\"),allUrl:new RegExp(`${o}\\\\[(.*)\\\\]\\\\((${e(this.option.replace_image_url)}.*?)\\\\)`,\"g\")}[t]}readFile(t,e=!1){if(!o.checkDataAction(\"String\",t))return;var i=r.readdirSync(t);let n=this.reg(\"allUrl\");i.forEach(i=>{let o=`${t}/${i}`;if(r.statSync(o).isDirectory()){if(!this.option.filter_item.includes(o))return this.readFile(o,e)}else if(-1!==i.indexOf(\".md\")){let t,i=r.readFileSync(o,\"utf-8\"),c=!1;for(;null!==(t=n.exec(i));){let o=t[2];if(-1!==o.indexOf(this.option.replace_image_url))if(e)try{let t=this.reg(\"sectionUrl\"),e=o.split(t);const r=this.fileNameFormat(e[2]);let n=`${this.option.new_image_url}${r}`;this.option.add_end&&(n+=this.option.add_end),c=!0,i=i.replace(o,n)}catch(t){throw`请检查new_image_url、var_number的设置：${t}`}else this.imgList.includes(o)||this.imgList.push(o)}e&&c&&(this.option.test?console.log(\"测试模式，不修改文件：\",o):r.writeFile(o,i,\"utf-8\",()=>{console.log(\"修改成功\",o)}))}})}downImg(){this.mkdirSync();let t=0;c.mapSeries(this.imgList,(e,i)=>{setTimeout(()=>{let o=this.reg(\"sectionUrl\"),r=e.split(o);try{if(r[2]){t++;const i=this.fileNameFormat(r[2]);this.downloadPic(e,`${this.option.down_img_src}/${i}`)}i(null,e)}catch(t){i(t,e)}},400)},(e,i)=>{if(e)throw e;console.log(\"图片下载完成：\",i,t)})}fileNameFormat(t){if(null===this.option.downFileNameCallBack){const e=/^(\\w+)/,i=t.match(e);i&&i[1]&&(t=i[1])}else{if(\"[object Function]\"!==Object.prototype.toString.call(this.option.downFileNameCallBack))throw\"处理图片名错误:\";if(\"string\"!=typeof(t=this.option.downFileNameCallBack(t)))throw\"处理图片名错误:\"}return t}downloadPic(t,e){n(t).pipe(r.createWriteStream(e)).on(\"close\",()=>{console.log(\"pic saved!\",t)})}mkdirSync(){try{r.statSync(this.option.down_img_src).isDirectory()||r.mkdirSync(this.option.down_img_src,{recursive:!0})}catch(t){r.mkdirSync(this.option.down_img_src,{recursive:!0})}}copyDir(t,e,i){r.access(e,i=>{i?r.mkdir(e,{recursive:!0},i=>{if(i)throw i;o(null,t,e)}):this.copyNow=!1});var o=(t,e,o)=>{t?i(t):r.readdir(e,(t,n)=>{t?i(t):n.forEach(t=>{var n=e+\"/\"+t,c=o+\"/\"+t;r.stat(n,(t,e)=>{t?i(t):e.isFile()?r.readFile(n,(t,e)=>{if(t)throw t;r.writeFile(c,e,t=>{if(t)throw`文件拷贝失败：${t}`;console.log(\"拷贝\",c)})}):e.isDirectory()&&this.copyDir(n,c,i)})})})}}updateOption(t={}){o.checkDataAction(\"Object\",t,\"updateOption的参数为对象\")&&(this.option=Object.assign(this.option,t))}}},function(t,e){t.exports={checkDataAction:(t,e,i=e)=>{if(((t,e)=>!(!t||!e)&&(\"String\"===t?\"string\"==typeof e:\"Object\"===t?\"[object Object]\"===Object.prototype.toString.call(e):\"number\"===t?\"number\"==typeof e:\"function\"===t&&\"[object Function]\"===Object.prototype.toString.call(e)))(t,e))return!0;console.error(\"检查数据出错：\",i)}}},function(t,e){}])});","extractedComments":[]}